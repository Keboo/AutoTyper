<Window x:Class="AutoTyper.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:dd="urn:gong-wpf-dragdrop"
        xmlns:local="clr-namespace:AutoTyper.UI"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:models="clr-namespace:AutoTyper.UI.Models"
        xmlns:viewModels="clr-namespace:AutoTyper.UI.ViewModels"
        Title="AutoTyper - Snippet Manager"
        Width="900"
        Height="600"
        d:DataContext="{d:DesignInstance Type=local:MainWindowViewModel,
                                         IsDesignTimeCreatable=False}"
        Style="{StaticResource MaterialDesignWindow}"
        Topmost="{Binding IsTopMost}"
        mc:Ignorable="d">

  <materialDesign:DialogHost CloseOnClickAway="True" Identifier="RootDialog">
    <materialDesign:DialogHost.DialogContentTemplate>
      <DataTemplate DataType="{x:Type viewModels:AddSnippetViewModel}">
        <Grid Width="600" Margin="20">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
          </Grid.RowDefinitions>

          <!-- Dialog Title -->
          <TextBlock Grid.Row="0"
                     Margin="0,0,0,20"
                     Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                     Text="Add snippet" />

          <!-- Snippet Type Selection -->
          <StackPanel Grid.Row="1" Margin="0,0,0,20" Orientation="Horizontal">
            <RadioButton Content="Text Snippet"
                         GroupName="SnippetType"
                         IsChecked="{Binding SnippetType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static models:SnippetType.Text}}"
                         Margin="0,0,20,0"
                         Style="{StaticResource MaterialDesignChoiceChipPrimaryRadioButton}" />
            <RadioButton Content="Image Snippet"
                         GroupName="SnippetType"
                         IsChecked="{Binding SnippetType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static models:SnippetType.Image}}"
                         Style="{StaticResource MaterialDesignChoiceChipPrimaryRadioButton}" />
          </StackPanel>

          <!-- Content Area -->
          <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <StackPanel>
              <!-- Text Snippet Fields -->
              <StackPanel Visibility="{Binding IsTextSnippet, Converter={StaticResource BooleanToVisibilityConverter}}">
                <!-- Use Clipboard Toggle -->
                <CheckBox Margin="0,0,0,15"
                          Content="Use clipboard content instead of specified text"
                          IsChecked="{Binding UseClipboard}" />

                <!-- Name -->
                <TextBox Margin="0,0,0,15"
                         materialDesign:HintAssist.Hint="Snippet Name"
                         IsEnabled="{Binding UseClipboard, Converter={StaticResource InverseBooleanConverter}}"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         Text="{Binding Name}" />

                <!-- Content -->
                <TextBox MaxHeight="200"
                         Margin="0,0,0,15"
                         VerticalContentAlignment="Top"
                         materialDesign:HintAssist.Hint="Content to Type"
                         AcceptsReturn="True"
                         IsEnabled="{Binding UseClipboard, Converter={StaticResource InverseBooleanConverter}}"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         Text="{Binding Content}"
                         TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto" />

                <!-- Delay -->
                <StackPanel Margin="0,0,0,10" Orientation="Horizontal">
                  <TextBlock Width="120"
                             VerticalAlignment="Center"
                             Text="Delay (seconds):" />
                  <TextBox Width="100"
                           materialDesign:HintAssist.Hint="3.0"
                           Text="{Binding Delay}" />
                </StackPanel>

                <!-- Fast Typing -->
                <CheckBox Margin="0,0,0,10"
                          Content="Fast Typing (No delay between keystrokes)"
                          IsChecked="{Binding FastTyping}" />

                <!-- Append New Line -->
                <CheckBox Margin="0,0,0,20"
                          Content="Append New Line (Press Enter after typing)"
                          IsChecked="{Binding AppendNewLine}" />
              </StackPanel>

              <!-- Image Snippet Fields -->
              <StackPanel Visibility="{Binding IsImageSnippet, Converter={StaticResource BooleanToVisibilityConverter}}">
                <!-- Name -->
                <TextBox Margin="0,4,0,15"
                         materialDesign:HintAssist.Hint="Snippet Name (optional - uses filename if empty)"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         Text="{Binding Name}" />

                <!-- Image Path -->
                <Grid Margin="0,0,0,15">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                  </Grid.ColumnDefinitions>
                  <TextBox Grid.Column="0"
                           Margin="0,0,10,0"
                           materialDesign:HintAssist.Hint="Image Path"
                           IsReadOnly="True"
                           Style="{StaticResource MaterialDesignOutlinedTextBox}"
                           Text="{Binding ImagePath}" />
                  <Button Grid.Column="1"
                          Command="{Binding BrowseImageCommand}"
                          Content="BROWSE"
                          Style="{StaticResource MaterialDesignRaisedButton}" />
                </Grid>

                <!-- Delay -->
                <StackPanel Margin="0,0,0,15" Orientation="Horizontal">
                  <TextBlock Width="150"
                             VerticalAlignment="Center"
                             Text="Delay (seconds):" />
                  <TextBox Width="100"
                           materialDesign:HintAssist.Hint="3.0"
                           Text="{Binding Delay}" />
                </StackPanel>

                <!-- Display Duration -->
                <StackPanel Margin="0,0,0,15" Orientation="Horizontal">
                  <TextBlock Width="150"
                             VerticalAlignment="Center"
                             Text="Display Duration (sec):" />
                  <TextBox Width="100"
                           materialDesign:HintAssist.Hint="5.0"
                           Text="{Binding DisplayDuration}" />
                </StackPanel>

                <!-- Corner Selection -->
                <StackPanel Margin="0,0,0,15">
                  <TextBlock Margin="0,0,0,8" Text="Display Corner:" />
                  <ComboBox materialDesign:HintAssist.Hint="Corner"
                            SelectedItem="{Binding Corner}"
                            Style="{StaticResource MaterialDesignOutlinedComboBox}">
                    <models:ImageCorner>TopLeft</models:ImageCorner>
                    <models:ImageCorner>TopRight</models:ImageCorner>
                    <models:ImageCorner>BottomLeft</models:ImageCorner>
                    <models:ImageCorner>BottomRight</models:ImageCorner>
                  </ComboBox>
                </StackPanel>

                <!-- Offset -->
                <StackPanel Margin="0,0,0,15">
                  <TextBlock Margin="0,0,0,8" Text="Offset (pixels):" />
                  <StackPanel Orientation="Horizontal">
                    <TextBlock Width="30"
                               VerticalAlignment="Center"
                               Text="X:" />
                    <TextBox Width="80"
                             Margin="0,0,20,0"
                             materialDesign:HintAssist.Hint="0"
                             Text="{Binding OffsetX}" />
                    <TextBlock Width="30"
                               VerticalAlignment="Center"
                               Text="Y:" />
                    <TextBox Width="80"
                             materialDesign:HintAssist.Hint="0"
                             Text="{Binding OffsetY}" />
                  </StackPanel>
                </StackPanel>

                <!-- Target Resolution -->
                <StackPanel Margin="0,0,0,15">
                  <TextBlock Margin="0,0,0,8" Text="Target Resolution (optional):" />
                  <StackPanel Orientation="Horizontal">
                    <TextBlock Width="60"
                               VerticalAlignment="Center"
                               Text="Width:" />
                    <TextBox Width="80"
                             Margin="0,0,20,0"
                             materialDesign:HintAssist.Hint="Auto"
                             Text="{Binding TargetWidth}" />
                    <TextBlock Width="60"
                               VerticalAlignment="Center"
                               Text="Height:" />
                    <TextBox Width="80"
                             materialDesign:HintAssist.Hint="Auto"
                             Text="{Binding TargetHeight}" />
                  </StackPanel>
                </StackPanel>

                <!-- Maintain Aspect Ratio -->
                <CheckBox Margin="0,0,0,15"
                          Content="Maintain aspect ratio when resizing"
                          IsChecked="{Binding MaintainAspectRatio}" />

                <!-- Monitor Selection -->
                <StackPanel Margin="0,0,0,15">
                  <TextBlock Margin="0,0,0,8" Text="Target Monitor:" />
                  <ComboBox materialDesign:HintAssist.Hint="Monitor"
                            SelectedItem="{Binding MonitorSelection}"
                            Style="{StaticResource MaterialDesignOutlinedComboBox}">
                    <ComboBox.ItemTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding Converter={StaticResource MonitorSelectionToStringConverter}}" />
                      </DataTemplate>
                    </ComboBox.ItemTemplate>
                    <models:MonitorSelection>CursorMonitor</models:MonitorSelection>
                    <models:MonitorSelection>PrimaryMonitor</models:MonitorSelection>
                    <models:MonitorSelection>MonitorByIndex</models:MonitorSelection>
                  </ComboBox>
                </StackPanel>

                <!-- Monitor Index -->
                <StackPanel Margin="0,0,0,20" Orientation="Horizontal">
                  <TextBlock Width="150"
                             VerticalAlignment="Center"
                             Text="Monitor Index:" />
                  <TextBox Width="100"
                           materialDesign:HintAssist.Hint="0"
                           IsEnabled="{Binding IsMonitorIndexEnabled}"
                           Text="{Binding MonitorIndex}" />
                </StackPanel>
              </StackPanel>
            </StackPanel>
          </ScrollViewer>

          <!-- Buttons -->
          <StackPanel Grid.Row="3"
                      HorizontalAlignment="Right"
                      Orientation="Horizontal">
            <Button Width="100"
                    Margin="0,0,10,0"
                    Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}"
                    Content="CANCEL"
                    Style="{StaticResource MaterialDesignOutlinedButton}" />
            <Button Width="100"
                    Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}"
                    CommandParameter="{x:Static local:DialogResult.Confirmed}"
                    Content="SAVE"
                    Style="{StaticResource MaterialDesignRaisedButton}" />
          </StackPanel>
        </Grid>
      </DataTemplate>
    </materialDesign:DialogHost.DialogContentTemplate>

    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

      <!-- Menu -->
      <Menu Grid.Row="0">
        <MenuItem Header="_File">
          <MenuItem Command="{Binding AddSnippetCommand}"
                    Header="_Add Snippet"
                    InputGestureText="Ctrl+N">
            <MenuItem.Icon>
              <materialDesign:PackIcon Kind="Plus" />
            </MenuItem.Icon>
          </MenuItem>
          <Separator />
          <MenuItem Command="{x:Static ApplicationCommands.Close}" Header="E_xit" />
        </MenuItem>
        <MenuItem Header="_View">
          <MenuItem Header="Always on _Top"
                    IsCheckable="True"
                    IsChecked="{Binding IsTopMost}">
            <MenuItem.Icon>
              <materialDesign:PackIcon Kind="Pin" />
            </MenuItem.Icon>
          </MenuItem>
          <Separator />
          <MenuItem Command="{Binding SetViewModeCommand}"
                    CommandParameter="{x:Static local:ViewMode.Full}"
                    Header="_Full View"
                    IsCheckable="True"
                    IsChecked="{Binding CurrentViewMode, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static local:ViewMode.Full}}">
            <MenuItem.Icon>
              <materialDesign:PackIcon Kind="ViewList" />
            </MenuItem.Icon>
          </MenuItem>
          <MenuItem Command="{Binding SetViewModeCommand}"
                    CommandParameter="{x:Static local:ViewMode.Compact}"
                    Header="_Compact View"
                    IsCheckable="True"
                    IsChecked="{Binding CurrentViewMode, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static local:ViewMode.Compact}}">
            <MenuItem.Icon>
              <materialDesign:PackIcon Kind="ViewHeadline" />
            </MenuItem.Icon>
          </MenuItem>
          <Separator />
          <MenuItem Command="{Binding ToggleThemeCommand}"
                    Header="_Dark Mode"
                    IsCheckable="True"
                    IsChecked="{Binding IsDarkMode}">
            <MenuItem.Icon>
              <materialDesign:PackIcon Kind="Brightness6" />
            </MenuItem.Icon>
          </MenuItem>
        </MenuItem>
      </Menu>

      <!-- Toolbar -->
      <materialDesign:ColorZone Grid.Row="1"
                                Padding="16,8"
                                materialDesign:ElevationAssist.Elevation="Dp2"
                                Mode="PrimaryMid">
        <DockPanel>
          <Button Margin="8,0,0,0"
                  Command="{Binding AddSnippetCommand}"
                  Content="ADD SNIPPET"
                  DockPanel.Dock="Right"
                  Style="{StaticResource MaterialDesignPaperSecondaryButton}">
            <Button.CommandParameter>
              <materialDesign:PackIcon Kind="Plus" />
            </Button.CommandParameter>
          </Button>

          <ToggleButton Margin="8,0,0,0"
                        Command="{Binding ToggleThemeCommand}"
                        DockPanel.Dock="Right"
                        IsChecked="{Binding IsDarkMode}"
                        Style="{StaticResource MaterialDesignActionToggleButton}"
                        ToolTip="Toggle Dark/Light Mode">
            <ToggleButton.Content>
              <materialDesign:PackIcon Kind="Brightness6" />
            </ToggleButton.Content>
            <materialDesign:ToggleButtonAssist.OnContent>
              <materialDesign:PackIcon Kind="WeatherNight" />
            </materialDesign:ToggleButtonAssist.OnContent>
          </ToggleButton>

          <StackPanel Orientation="Horizontal">
            <materialDesign:PackIcon Margin="0,0,8,0"
                                     VerticalAlignment="Center"
                                     Kind="CodeBraces" />
            <TextBlock VerticalAlignment="Center"
                       FontSize="18"
                       FontWeight="Medium"
                       Text="Snippets" />
          </StackPanel>
        </DockPanel>
      </materialDesign:ColorZone>

      <!-- Snippet List -->
      <ScrollViewer Grid.Row="2"
                    Margin="16"
                    VerticalScrollBarVisibility="Auto">
        <ItemsControl dd:DragDrop.DropHandler="{Binding}"
                      dd:DragDrop.IsDragSource="True"
                      dd:DragDrop.IsDropTarget="True"
                      ItemsSource="{Binding Snippets}">
          <ItemsControl.ItemTemplate>
            <DataTemplate DataType="{x:Type models:Snippet}">
              <materialDesign:Card Margin="0,0,0,12" Padding="0">
                <Grid>
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                  </Grid.ColumnDefinitions>

                  <!-- Clickable content area -->
                  <Button Grid.Column="0"
                          Height="Auto"
                          Padding="16"
                          HorizontalContentAlignment="Stretch"
                          Command="{Binding DataContext.ExecuteSnippetCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                          CommandParameter="{Binding}"
                          Style="{StaticResource MaterialDesignFlatButton}">
                    <Grid>
                      <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                      </Grid.RowDefinitions>

                      <!-- Full View Layout -->
                      <Grid Grid.Row="0" Grid.RowSpan="3">
                        <Grid.Style>
                          <Style TargetType="Grid">
                            <Setter Property="Visibility" Value="Visible" />
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding DataContext.CurrentViewMode, RelativeSource={RelativeSource AncestorType=Window}}" Value="{x:Static local:ViewMode.Compact}">
                                <Setter Property="Visibility" Value="Collapsed" />
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </Grid.Style>

                        <Grid.RowDefinitions>
                          <RowDefinition Height="Auto" />
                          <RowDefinition Height="Auto" />
                          <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <!-- Name -->
                        <TextBlock Grid.Row="0"
                                   Margin="0,0,0,4"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Text="{Binding Name}" />

                        <!-- Content Preview -->
                        <TextBlock Grid.Row="1"
                                   Margin="0,0,0,8"
                                   Opacity="0.7"
                                   TextTrimming="CharacterEllipsis"
                                   TextWrapping="NoWrap">
                          <TextBlock.Style>
                            <Style TargetType="TextBlock">
                              <Setter Property="Text" Value="{Binding Content}" />
                              <Style.Triggers>
                                <DataTrigger Binding="{Binding UseClipboard}" Value="True">
                                  <Setter Property="FontStyle" Value="Italic" />
                                  <Setter Property="Text" Value="Types current clipboard content" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding SnippetType}" Value="{x:Static models:SnippetType.Image}">
                                  <Setter Property="FontStyle" Value="Italic" />
                                  <Setter Property="Text" Value="{Binding ImagePath}" />
                                </DataTrigger>
                              </Style.Triggers>
                            </Style>
                          </TextBlock.Style>
                        </TextBlock>

                        <!-- Properties -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal">
                          <!-- Text snippet properties -->
                          <StackPanel Orientation="Horizontal">
                            <StackPanel.Style>
                              <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Visible" />
                                <Style.Triggers>
                                  <DataTrigger Binding="{Binding SnippetType}" Value="{x:Static models:SnippetType.Image}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                  </DataTrigger>
                                </Style.Triggers>
                              </Style>
                            </StackPanel.Style>
                            
                            <materialDesign:Chip Margin="0,0,8,0"
                                                 Content="{Binding Delay, StringFormat='{}{0}s delay'}"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Primary}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Primary.Foreground}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="ClockOutline" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>

                            <materialDesign:Chip Margin="0,0,8,0"
                                                 Content="Fast Typing"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Secondary}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Secondary.Foreground}"
                                                 Visibility="{Binding FastTyping, Converter={StaticResource BooleanToVisibilityConverter}}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="FlashOutline" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>

                            <materialDesign:Chip Content="+ Enter"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Primary.Light}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Primary.Light.Foreground}"
                                                 Visibility="{Binding AppendNewLine, Converter={StaticResource BooleanToVisibilityConverter}}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="KeyboardReturn" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>
                          </StackPanel>

                          <!-- Image snippet properties -->
                          <StackPanel Orientation="Horizontal">
                            <StackPanel.Style>
                              <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                  <DataTrigger Binding="{Binding SnippetType}" Value="{x:Static models:SnippetType.Image}">
                                    <Setter Property="Visibility" Value="Visible" />
                                  </DataTrigger>
                                </Style.Triggers>
                              </Style>
                            </StackPanel.Style>

                            <materialDesign:Chip Margin="0,0,8,0"
                                                 Content="{Binding Delay, StringFormat='{}{0}s delay'}"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Primary}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Primary.Foreground}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="ClockOutline" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>

                            <materialDesign:Chip Margin="0,0,8,0"
                                                 Content="{Binding DisplayDuration, StringFormat='{}{0}s display'}"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Secondary}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Secondary.Foreground}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="ImageOutline" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>

                            <materialDesign:Chip Content="{Binding Corner}"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Primary.Light}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Primary.Light.Foreground}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="ArrowExpandAll" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>
                          </StackPanel>
                        </StackPanel>
                      </Grid>

                      <!-- Compact View Layout -->
                      <DockPanel Grid.Row="0" Grid.RowSpan="3">
                        <DockPanel.Style>
                          <Style TargetType="DockPanel">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding DataContext.CurrentViewMode, RelativeSource={RelativeSource AncestorType=Window}}" Value="{x:Static local:ViewMode.Compact}">
                                <Setter Property="Visibility" Value="Visible" />
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </DockPanel.Style>

                        <!-- Chips on the right -->
                        <StackPanel Margin="16,0,0,0"
                                    DockPanel.Dock="Right"
                                    Orientation="Horizontal">
                          <!-- Text snippet chips -->
                          <StackPanel Orientation="Horizontal">
                            <StackPanel.Style>
                              <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Visible" />
                                <Style.Triggers>
                                  <DataTrigger Binding="{Binding SnippetType}" Value="{x:Static models:SnippetType.Image}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                  </DataTrigger>
                                </Style.Triggers>
                              </Style>
                            </StackPanel.Style>

                            <materialDesign:Chip Margin="0,0,4,0"
                                                 Content="{Binding Delay, StringFormat='{}{0}s'}"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Primary}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Primary.Foreground}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="ClockOutline" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>

                            <materialDesign:Chip Margin="0,0,4,0"
                                                 Content="Fast"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Secondary}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Secondary.Foreground}"
                                                 Visibility="{Binding FastTyping, Converter={StaticResource BooleanToVisibilityConverter}}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="FlashOutline" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>

                            <materialDesign:Chip Content="↵"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Primary.Light}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Primary.Light.Foreground}"
                                                 Visibility="{Binding AppendNewLine, Converter={StaticResource BooleanToVisibilityConverter}}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="KeyboardReturn" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>
                          </StackPanel>

                          <!-- Image snippet chips -->
                          <StackPanel Orientation="Horizontal">
                            <StackPanel.Style>
                              <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                  <DataTrigger Binding="{Binding SnippetType}" Value="{x:Static models:SnippetType.Image}">
                                    <Setter Property="Visibility" Value="Visible" />
                                  </DataTrigger>
                                </Style.Triggers>
                              </Style>
                            </StackPanel.Style>

                            <materialDesign:Chip Margin="0,0,4,0"
                                                 Content="{Binding Delay, StringFormat='{}{0}s'}"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Primary}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Primary.Foreground}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="ClockOutline" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>

                            <materialDesign:Chip Margin="0,0,4,0"
                                                 Content="{Binding DisplayDuration, StringFormat='{}{0}s'}"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Secondary}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Secondary.Foreground}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="ImageOutline" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>

                            <materialDesign:Chip Content="{Binding Corner}"
                                                 IconBackground="{DynamicResource MaterialDesign.Brush.Primary.Light}"
                                                 IconForeground="{DynamicResource MaterialDesign.Brush.Primary.Light.Foreground}">
                              <materialDesign:Chip.Icon>
                                <materialDesign:PackIcon Kind="ArrowExpandAll" />
                              </materialDesign:Chip.Icon>
                            </materialDesign:Chip>
                          </StackPanel>
                        </StackPanel>

                        <!-- Name on the left -->
                        <TextBlock VerticalAlignment="Center"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Text="{Binding Name}" />
                      </DockPanel>
                    </Grid>
                  </Button>

                  <!-- Action Buttons -->
                  <materialDesign:PopupBox Grid.Column="1"
                                           Margin="8"
                                           VerticalAlignment="Center"
                                           PlacementMode="BottomAndAlignRightEdges"
                                           StaysOpen="False">
                    <StackPanel>
                      <Button Command="{Binding DataContext.CopySnippetCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                              CommandParameter="{Binding}"
                              Content="Copy"
                              ToolTip="Copy Snippet to Clipboard">
                        <Button.Style>
                          <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignPopupBoxButton}">
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding UseClipboard}" Value="True">
                                <Setter Property="Visibility" Value="Collapsed" />
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </Button.Style>
                        <Button.ContentTemplate>
                          <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                              <materialDesign:PackIcon Margin="0,0,8,0"
                                                       VerticalAlignment="Center"
                                                       Kind="ContentCopy" />
                              <TextBlock VerticalAlignment="Center" Text="Copy" />
                            </StackPanel>
                          </DataTemplate>
                        </Button.ContentTemplate>
                      </Button>
                      <Button Command="{Binding DataContext.EditSnippetCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                              CommandParameter="{Binding}"
                              ToolTip="Edit Snippet">
                        <Button.ContentTemplate>
                          <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                              <materialDesign:PackIcon Margin="0,0,8,0"
                                                       VerticalAlignment="Center"
                                                       Kind="Edit" />
                              <TextBlock VerticalAlignment="Center" Text="Edit" />
                            </StackPanel>
                          </DataTemplate>
                        </Button.ContentTemplate>
                      </Button>
                      <Button Command="{Binding DataContext.DeleteSnippetCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                              CommandParameter="{Binding}"
                              Content="Delete"
                              ToolTip="Delete Snippet">
                        <Button.ContentTemplate>
                          <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                              <materialDesign:PackIcon Margin="0,0,8,0"
                                                       VerticalAlignment="Center"
                                                       Kind="Delete" />
                              <TextBlock VerticalAlignment="Center" Text="Delete" />
                            </StackPanel>
                          </DataTemplate>
                        </Button.ContentTemplate>
                      </Button>
                    </StackPanel>
                  </materialDesign:PopupBox>
                </Grid>
              </materialDesign:Card>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>

      <!-- Status Bar -->
      <materialDesign:ColorZone Grid.Row="3"
                                Padding="16,8"
                                Mode="PrimaryLight">
        <DockPanel>
          <materialDesign:PackIcon Margin="0,0,8,0"
                                   VerticalAlignment="Center"
                                   Kind="Information" />
          <TextBlock VerticalAlignment="Center" Text="{Binding StatusMessage}" />
        </DockPanel>
      </materialDesign:ColorZone>
    </Grid>
  </materialDesign:DialogHost>

  <Window.InputBindings>
    <KeyBinding Key="N"
                Command="{Binding AddSnippetCommand}"
                Modifiers="Ctrl" />
  </Window.InputBindings>
</Window>
